# otp-profile-score

[![build status](https://secure.travis-ci.org/conveyal/otp-profile-score.png)](http://travis-ci.org/conveyal/otp-profile-score)

Score OTP profiles

## Installation

Requires [nodejs](http://nodejs.org/).

```sh
$ npm install otp-profile-score
```

## Tests

```sh
$ npm test
```

## API

<!-- Generated by documentation.js. Update this documentation by updating the source code. -->

#### Table of Contents

-   [ProfileScore](#profilescore)
    -   [processOption](#processoption)
    -   [processOptions](#processoptions)
    -   [score](#score)
    -   [tally](#tally)

### ProfileScore

Process & score an OTP Profile response. Tally statistics, score options.

**Parameters**

-   `opts` **[Object](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object)** Options object.
    -   `opts.factors` **[Object](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object)?** Factors to override the defaults.
    -   `opts.rates` **[Object](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object)?** Rates to to override the defaults.

**Examples**

```javascript
const ProfileScore = require('otp-profile-score')
const scorer = new ProfileScore({ factors: {}, rates: {} })
```

#### processOption

Process an individual option, only uses the first access and egress modes given.

**Parameters**

-   `option` **[Object](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object)** Option returned from OTP's profiler.

**Examples**

```javascript
getProfileFromOTP(query, function(err, profile) {
  const scoredOption = scorer.processOption(profile[0])
})
```

Returns **[Object](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object)** processedOption Annotated and scored.

#### processOptions

Process an array of options that were generated by [OpenTripPlanner](http://www.opentripplanner.org)'s Profiler.

**Parameters**

-   `options` **[Array](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array)** 

**Examples**

```javascript
getProfileFromOTP(query, function(err, profile) {
  const allScoredResults = scorer.processOptions(profile)
})
```

Returns **[Array](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array)** processedOptions Options that are split up by access mode and annotated with a score.

#### score

Get the weighted score of an option based on the factors, weights, and tallied totals for that option.

**Parameters**

-   `option` **[Object](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object)** 

Returns **[number](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Number)** score

#### tally

Tally values. Add up total calories, cost, transfers, distances, and times.

**Parameters**

-   `option` **[Object](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object)** 

Returns **[Object](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object)** talliedOption
